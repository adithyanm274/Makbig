{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="shop-area">
            <div class="breadcrumb-area">
               <ul>
                  <li><a href="{% url 'home' %}">Home</a></li>
                  <li><span>Shop</span></li>
               </ul>
            </div>
            <div class="row">
               <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12">
                  <div class="sidebar-area">
                     <div class="shop-widget">
                        <div class="widget-title">
                           <h2>categories</h2>
                        </div>
                        <div class="widget-content">
                           <ul id="accordion">
                              <li>
                                 <h4>Collection <span class="plusminus">-</span></h4>
                                 <ul style="display: block;">
                                 {% for cat in categories %}
                                    <li>
                             <a href="{% url 'shop' %}" class="category-link" data-id="{{ cat.id }}">{{ cat.title }}</a>                                    </li>
                                 {% endfor %}
                                 </ul>
                              </li>
                        </div>
                     </div>
                     <div class="shop-widget">
                        <div class="widget-title">
                           <h2>Shop By</h2>
                        </div>
                        <div class="widget-content">
                           <ul>
                              <li>
                                 <h4>Manufacturer</h4>
                                 <ul>
                                    <li><a href="shop.html">Adidas</a><span>(20)</span></li>
                                    <li><a href="shop.html">Converse</a><span>(16)</span></li>
                                    <li><a href="shop.html">Nike</a><span>(10)</span></li>
                                    <li><a href="shop.html">Gucci</a><span>(25)</span></li>
                                 </ul>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <div class="shop-widget">
                        <h3>Price Filter</h3>
                        <div class="widget-content">
                           <div id="slider-range"></div>
                           <input type="text" id="amount">
                        </div>
                     </div>
                     <div class="shop-widget">
                        <div class="widget-content">
                           <ul>
                              <li>
                                 <h4>Color Options</h4>
                                 <ul>
                                    <li><a href="shop.html">Black</a><span>(8)</span></li>
                                    <li><a href="shop.html">White</a><span>(12)</span></li>
                                    <li><a href="shop.html">Blue</a><span>(10)</span></li>
                                    <li><a href="shop.html">Yellow</a><span>(14)</span></li>
                                    <li><a href="shop.html">Red</a><span>(17)</span></li>
                                    <li><a href="shop.html">Green</a><span>(20)</span></li>
                                 </ul>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <div class="shop-widget">
                        <div class="widget-content">
                           <ul>
                              <li>
                                 <h4>Size Options</h4>
                                 <ul>
                                    <li><a href="shop.html">L</a><span>(8)</span></li>
                                    <li><a href="shop.html">M</a><span>(12)</span></li>
                                    <li><a href="shop.html">S</a><span>(10)</span></li>
                                    <li><a href="shop.html">XL</a><span>(14)</span></li>
                                    <li><a href="shop.html">XX</a><span>(17)</span></li>
                                 </ul>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <div class="shop-widget">
                        <div class="widget-title">
                           <h2>Compare</h2>
                        </div>
                        <div class="widget-content">
                           <p>You have no items to compare.</p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12">
                  <div class="shop-left-sidebar">
                     <div class="shop-banner">
                        <h3>New Style 2019</h3>
                        <h4>Furniture</h4>
                        <p>It is a long established fact that a reader will be<br>
                           distracted by the readable content.
                        </p>
                     </div>
                     <div class="shop-products">
                        <div class="filter-bar">
                           <div class="row">
                              <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                 <div class="prd-tab">
                                    <ul class="nav nav-tabs" id="myTab1" role="tablist">
                                       <li class="nav-item">
                                          <a class="nav-link active" id="tab-1" data-toggle="tab" href="#tab1" role="tab" aria-controls="tab1" aria-selected="true"><i class="fas fa-list-ul"></i></a>
                                       </li>
                                       <li class="nav-item">
                                          <a class="nav-link" id="tab-2" data-toggle="tab" href="#tab2" role="tab" aria-controls="tab2" aria-selected="false"><i class="fas fa-th-large"></i></a>
                                       </li>
                                    </ul>
                                 </div>
                                 <div class="product-filter">
                                    <form action="#">
                                       <select name="pro-filter" id="pro-filter">
                                          <option value="1">Default Sorting </option>
                                          <option value="3">New Product </option>
                                          <option value="2">Top Sales </option>
                                       </select>
                                    </form>
                                 </div>
                              </div>
                              <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                 <div class="product-showing">
                                    <p>SHOWING {{products.count}}  RESULTS </p>
                                 </div>
                              </div>
                           </div>
                        </div>
                       <div class="tab-content" id="myTabContent-1">
                    <div class="tab-pane fade show active" id="tab1{{forloop.counter}}" role="tabpanel" aria-labelledby="tab-1">
                    <div class="shop-grid">
                <div class="product-item">
                 <div class="row">
                    <ul id="product-container">

                        {% for product in products %}
                            <li>
                                <div class="product-grid">
                                    <div class="product-image">
                                        <a href="{% url 'product_detail' product.id %}">
                                            <img class="pic-1" src="{{product.feature_image}}" style="height:320px;width:200px;" alt="Product image">
                                        </a>
                                        <ul class="social">
                                            <li><a href="#" data-tip="Quick View"><i class="fa fa-eye"></i></a></li>
                                            <li><a href="#" data-tip="Wishlist"><i class="fa fa-shopping-bag"></i></a></li>
                                            <li><a href="#" data-tip="Compare"><i class="fas fa-exchange-alt"></i></a></li>
                                        </ul>
                                    </div>
                                    <div class="product-content">
                                        <h3 class="title">{{ product.title|truncatechars:50 }}</h3>
                                        <div class="price">RS:{{ product.price }}
                                            <span>$20.00</span>
                                        </div>
                                        <a class="add-to-cart" href="cart.html">Add To Cart</a>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
                                          


   {% comment %} ####################################### {% endcomment %}
                           <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab-2">
                              <div class="shop-list">
                               <ul id="product-container">
                                 {% for product in products %}
                                    <li>
                                       <div class="product-list">
                                          <div class="row">
                                             <div class="col-xl-4 col-lg-5 col-md-5 col-sm-12">
                                                <div class="product-image">
                                                   <a href="{% url 'product_detail' product.id %}">
                                                   <img class="pic-1" src="{{product.feature_image}}"style="height:250px;width:200px;" alt="Product image">
                                                   </a>                                                
                                                </div>
                                             </div>
                                             <div class="col-xl-8 col-lg-7 col-md-7 col-sm-12">
                                                <div class="list-content">
                                                   <h3><a href="{% url 'product_detail' product.id %}">{{ product.title|truncatechars:50 }}</a></h3>
                                                   <p>{{product.short_description|safe|truncatechars:150}}</p>
                                                   <div class="price">Rs:{{product.price}}
                                                   </div>
                                                   <div class="listcart-area">
                                                      <div class="list-cart">
                                                         <a class="add-to-cart" href="cart.html">Add To Cart</a>
                                                      </div>
                                                      <div class="social">
                                                         <ul>
                                                            <li><a href="#" title="Quick View"><i class="fa fa-eye"></i></a></li>
                                                            <li><a href="#" title="Wishlist"><i class="fa fa-shopping-bag"></i></a></li>
                                                            <li><a href="#" title="Compare"><i class="fas fa-exchange-alt"></i></a></li>
                                                         </ul>
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </li>
                                    </li>
                                    {% endfor %}
                                 </Ul>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="pagination-area">
                        <nav aria-label="Page navigation example">
                           <ul class="pagination">
                              <li class="page-item">
                                 <a class="page-link" href="#" aria-label="Previous">
                                 <span aria-hidden="true">&laquo;</span>
                                 <span class="sr-only">Previous</span>
                                 </a>
                              </li>
                              <li class="page-item"><a class="page-link" href="javascript:;">1</a></li>
                              <li class="page-item"><a class="page-link" href="javascript:;">2</a></li>
                              <li class="page-item"><a class="page-link" href="javascript:;">3</a></li>
                              <li class="page-item">
                                 <a class="page-link" href="#" aria-label="Next">
                                 <span aria-hidden="true">&raquo;</span>
                                 <span class="sr-only">Next</span>
                                 </a>
                              </li>
                           </ul>
                        </nav>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   
   {% block js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function() {
    $(".category-link").click(function(e) {
        e.preventDefault();

        let categoryId = $(this).data("id");
        console.log("Fetching products for category:", categoryId);

        $.ajax({
            url: "{% url 'filter_category' %}",
            type: "GET",
            data: { category_id: categoryId },
            dataType: "json",
            success: function(response) {
                console.log("Success:", response);

                if (response.length === 0) {
                    // Redirect to error page when no products found
                    window.location.href = "/error_page/";
                    return;
                }

                let productGrid = $(".shop-grid ul");
                let productList = $(".shop-list ul");

                productGrid.empty();
                productList.empty();

                response.forEach(product => {
                    let productGridItem = `
                        <li>
                            <div class="product-grid">
                                <div class="product-image">
                                    <a href="/product_detail/${product.id}">
                                        <img src="${product.feature_image}" alt="${product.title}">
                                    </a>
                                </div>
                                <div class="product-content">
                                    <h3 class="title"><a href="/product_detail/${product.id}">${product.title.substring(0, 50)}</a></h3>
                                    <div class="price">RS: ${product.price}</div>
                                    <a class="add-to-cart" href="#">Add To Cart</a>
                                </div>
                            </div>
                        </li>
                    `;

                    let productListItem = `
                        <li>
                            <div class="product-list">
                                <div class="row">
                                    <div class="col-xl-4 col-lg-5 col-md-5 col-sm-12">
                                        <div class="product-image">
                                            <a href="/product_detail/${product.id}">
                                                <img class="pic-1" src="${product.feature_image}" style="height:250px;width:200px;" alt="${product.title}">
                                            </a>                                                            
                                        </div>
                                    </div>
                                    <div class="col-xl-8 col-lg-7 col-md-7 col-sm-12">
                                        <div class="list-content">
                                            <h3><a href="/product_detail/${product.id}">${product.title.substring(0, 50)}</a></h3>
                                            <div class="price">Rs: ${product.price}</div>
                                            <div class="listcart-area">
                                                <div class="list-cart">
                                                    <a class="add-to-cart" href="#">Add To Cart</a>
                                                </div>
                                                <div class="social">
                                                    <ul>
                                                        <li><a href="#" title="Quick View"><i class="fa fa-eye"></i></a></li>
                                                        <li><a href="#" title="Wishlist"><i class="fa fa-shopping-bag"></i></a></li>
                                                        <li><a href="#" title="Compare"><i class="fas fa-exchange-alt"></i></a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    `;

                    productGrid.append(productGridItem);
                    productList.append(productListItem);
                });
            },
            error: function(xhr, status, error) {
                if (xhr.status === 404) {
                    // Redirect to error page when no products are found
                    window.location.href = "/error_page/";
                } else {
                    console.error("AJAX Error:", xhr.status, xhr.responseText);
                    alert("Failed to load products. Check console for details.");
                }
            }
        });
    });
});
</script>

{% endblock js %}

 {% endblock %}       